{% from "govuk/components/table/macro.njk" import govukTable %}

{% macro cancellationSummary(activityDate, cancelledSessions = []) %}
  {% set rows = [] %}
  {% set headerSlots = []  %}

  {% for session in cancelledSessions %}
    {% set sessionText %}
      {{ session.activitySchedule.description }} ({{ session.timeSlot }})
    {% endset %}

    {% if session.timeSlot not in headerSlots %}
      {% set headerSlots = (headerSlots.push(session.timeSlot), headerSlots) %}
    {% endif %}

    {% set rows = (rows.push([{
      text: sessionText
    }]), rows) %}
  {% endfor %}

  {% if rows.length %}
    {% set headerSlotText = activityDate | formatDate("EEEE, d MMMM yyyy") %}
    {% for slot in headerSlots %}
      {% if loop.index == 1 %}
        {% set headerSlotText = headerSlotText + " - " + slot %}
      {% elif loop.index == (rows.length - 1) %}
        {% set headerSlotText = headerSlotText + " and " + slot  %}
      {% else %}
        {% set headerSlotText = headerSlotText + ", " + slot %}
      {% endif %}
    {% endfor %}

    {{ govukTable({
      head: [{
        text: headerSlotText
      }],
      rows: rows,
      attributes: { "data-qa": "prisonRegimeTimesSummary" }
    }) }}
  {% endif %}
{% endmacro %}
