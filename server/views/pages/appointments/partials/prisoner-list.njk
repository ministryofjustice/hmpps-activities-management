{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "partials/showProfileLink.njk" import showProfileLink %}

{% macro prisonerList(appointmentId, appointmentOccurrenceId, appointmentType, repeat, prisoners, isCancelled) %}
    {% set occurenceLink = '/appointments/' + appointmentId + '/occurrence/' + appointmentOccurrenceId  %}
    {% set prisonerListRows = [] %}
    {% for prisoner in prisoners %}
        {% set prisonerListRows = (prisonerListRows.push({
            key: {
                text: "Name of attendee"
            },
            value: {
                html: showProfileLink({
                    name: prisoner | fullName,
                    prisonerNumber: prisoner.prisonerNumber,
                    cellLocation: prisoner.cellLocation,
                    link: true
                })
            },
            actions: {
                items: [
                    {
                        href: occurenceLink + "/edit/start/" + prisoner.prisonerNumber + "/remove",
                        text: "Remove",
                        classes: "govuk-link--no-visited-state",
                        attributes: { 'data-qa': 'remove-prisoner' }
                    }
                ] if prisoners.length > 1 and isCancelled == false
            }
        }), prisonerListRows) %}
    {% endfor %}

    {% set prisonerActionItems = [{
        href: occurenceLink + "/movement-slip",
        text: "Print movement slip" + ("s" if prisoners.length > 1 ),
        classes: "govuk-link--no-visited-state",
        attributes: {
            'target': '_blank',
            'data-qa': 'print-movement-slips'
        }
    }] %}
    {% if appointmentType == AppointmentType.GROUP %}
        {% set prisonerActionItems = (prisonerActionItems.push(
            {
                href: occurenceLink + "/edit/start/prisoners/add",
                text: "Add people",
                classes: "govuk-link--no-visited-state",
                attributes: { 'data-qa': 'add-prisoners' }
            }
        ), prisonerActionItems) %}
    {% endif %}

    {{ govukSummaryList({
        card: {
            title: {
                text: prisoners | length + (" attendee" if prisoners.length == 1 else " attendees")
            },
            actions: {
                items: prisonerActionItems
            } if isCancelled == false
        },
        rows: prisonerListRows,
        attributes: { 'data-qa': 'prisoner-list' }
    }) }}
{% endmacro %}
