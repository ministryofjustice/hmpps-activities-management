{% extends "layout.njk" %}

{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "components/sticky-select.njk" import stickySelect %}
{% from "partials/formatSessions.njk" import formatSessions %}
{% from "partials/attendance/attendanceSummaryList.njk" import attendanceSummaryList %}
{% from "partials/showProfileLink.njk" import showProfileLink %}
{% from "partials/statusBasedCellLocation.njk" import statusBasedCellLocation %}
{% from "partials/attendance/attendanceTag.njk" import attendanceTag %}
{% from "partials/payStatus.njk" import payStatus %}
{% from "partials/attendance/incentiveLevelWarningTag.njk" import incentiveLevelWarningTag %}
{% from "partials/attendance/otherEvent.njk" import otherEvent %}
{% from "partials/attendance/attendanceRowsTableWithStickySelect.njk" import attendanceRowsTableWithStickySelect %}
{% from "partials/showLocation.njk" import showLocation %}
{% from "partials/service-user-name.njk" import serviceUserName %}

{% set pageTitle = applicationName + " - Select people to record attendance for" %}
{% set pageId = 'select-people-to-record-attendance-for-page' %}
{% set hardBackLinkText = 'Back' %}
{% set hardBackLinkHref = "choose-details-by-residential-location" %}

{% set displayDate = activityDate | formatDate %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
            <h1 class="govuk-heading-xl govuk-!-margin-bottom-4">
                <span class="govuk-caption-l">Record activity attendance <span class="govuk-visually-hidden">for</span></span>
                {{ location.name }} - record or edit activity attendance
                <span class="govuk-caption-l">{{ displayDate }} - {{ timePeriodFilter }}</span>
            </h1>
                
            <div class="govuk-grid-row govuk-!-margin-bottom-4">
                <div class="govuk-grid-column-two-thirds">
                    <h2 class="govuk-heading-m">{{ attendanceRows | length }}
                        {{ "person" if attendanceRows | length == 1 else "people" }} allocated</h2>
                    {{ attendanceSummaryList(attendanceSummary, instance) }}
                </div>
            </div>
        </div>
        <div class="govuk-grid-column-full">
            <form method='POST' data-module="form-spinner" data-loading-text="Marking attendance">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}">
                {{ attendanceRowsTableWithStickySelect(attendanceRows, instance, user.activeCaseLoadId, true, false) }}
            </form>
        </div>
    </div>
{% endblock %}

    {% macro renderOtherEvents(otherEvents) %}
        {% for event in otherEvents %}
            {{ otherEvent(event, true) }}
            {% if not loop.last %}<hr class="mid-grey-tint-20-hr dash-border">{% endif %}
        {% endfor %}
    {% endmacro %}

    {% macro renderViewLink(attendee) %}
        {% if attendee.attendance.status === 'COMPLETED' or attendee.attendance.attendanceHistory | length %}
            <a href="{{ attendee.instance.id }}/attendance-details/{{ attendee.attendance.id }}" class="govuk-link govuk-link--no-visited-state">
                {% if attendee.attendance.editable and attendee.instance.activitySchedule.activity.attendanceRequired %}
                View or Edit
            {% else %}
                View
            {% endif %}
            </a>
        {% endif %}
    {% endmacro %}
    