{% extends "layout.njk" %}

{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/tag/macro.njk" import govukTag %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "partials/activities/days-and-custom-times.njk" import daysAndCustomTimes %}
{% from "partials/statusBasedCellLocation.njk" import statusBasedCellLocation %}
{% from "partials/showLocation.njk" import showLocation %}

{% set pageTitle = applicationName + " - Allocate to an activity - Check and confirm answers" %}
{% set pageId = 'check-and-confirm-multiple-page' %}

{% block content %}
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">
            <span class="govuk-caption-xl">{{ session.allocateJourney.activity.name }}</span>
                <h1 class="govuk-heading-xl">Check and confirm {{ session.allocateJourney.inmates | length }} allocation{% if session.allocateJourney.inmates | length > 1 %}s{% endif %}</h1>
        </div>
    </div>
    <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">

            {% set endDateOption = ('remove-end-date-option' if session.allocateJourney.endDate else 'end-date') %}

                {{ govukSummaryList({
                    rows: [
                        {
                            key: { text: "Activity" },
                            value: { text: session.allocateJourney.activity.name }
                        },
                        {
                            key: { text: "Location" },
                            value: { text: showLocation(session.allocateJourney.activity) }
                        },
                        {
                            key: { text: "Start of allocation" },
                            value: {
                                text: session.allocateJourney.startDate | formatDate
                                },
                            actions: {
                                items: [{
                                    href: "start-date?preserveHistory=true",
                                    classes: 'govuk-link--no-visited-state',
                                    text: "Change",
                                    visuallyHiddenText: "change start date"
                                }]
                            }
                        },
                        {
                            key: { text: "End of allocation" },
                            value: {
                                text: session.allocateJourney.endDate | formatDate if session.allocateJourney.endDate else "No date set"
                            },
                            actions: {
                                items: [{
                                    href: endDateOption,
                                    classes: 'govuk-link--no-visited-state',
                                    text: "Change",
                                    visuallyHiddenText: "change end date"
                                }]
                            }
                        },
                        {
                            key: { text: "Number of people youâ€™re allocating" },
                            value: { text: session.allocateJourney.inmates | length }
                        }
                    ]
                }) }}
            {% endif %}

            {% set buttonText = "Confirm allocation" if session.allocateJourney.inmates | length === 1 else "Confirm " + session.allocateJourney.inmates | length + " allocations" %}
            <form method="POST">
                <input type="hidden" name="_csrf" value="{{ csrfToken }}" />
                <div class="govuk-button-group">
                    {{ govukButton({ 
                        text: buttonText,
                        preventDoubleClick: true
                    }) }}
                </div>
            </form>
        </div>
    </div>
{% endblock %}